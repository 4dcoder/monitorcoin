
module.exports.validateArray = function(array, arrayKeys)
{
    var _ = require("underscore");
    var len = arrayKeys == undefined ? 0 : arrayKeys.length;
    for (var i = 0; i < len; i++) {
        if ( !_.has(array, arrayKeys[ i ]) ) {
            return arrayKeys[ i ];
        }
    }
    return null;
};

module.exports.getUser = function( req )
{
    var Q = require('q');
    var deferred = Q.defer();
    var token = req.session.token ? req.session.token : req.body.token;

    User.findOneByToken(token).then( function (user) {
        if ( !user ) {
            deferred.reject( MyError.get( 1 ) );
        } else {
            deferred.resolve( user );
        }
    }).fail(function (err) {
            deferred.reject( err )
        } );
    return deferred.promise;
};

module.exports.formatJSON = function( required, data )
{
    function formatJS( required, data ) {
        var obj = {};
        for ( var i in required ) {
            var name = required[ i ];
            obj[ name ] = data[ name ];
        }
        return obj;
    }

    if ( _.isArray( data ) ) {
        var arr = [];
        for ( var i in data ) {
            arr[i] = formatJS( required, data[ i ] );
        }
        return arr;
    } else {
        return formatJS( required, data );
    }
};

module.exports.buildResponse = function( success, data, error ) {
    return {
        'success': success,
        'data': data,
        'error': !_.isUndefined( error ) ? error : ""
    };
};